《全球人文地理知识共享平台数据库设计文档》
版本号：V1.0
编制日期：2025年12月28日
编制单位：项目开发团队
一、数据库概述
1.1 设计目的
支撑平台核心功能（世界人文地图、主题专题、用户贡献、数据工具等）的数据存储与高效访问，确保数据一致性、安全性和可扩展性。
1.2 设计范围
覆盖用户管理、地域信息、专题内容、用户贡献、互动记录、数据工具等模块的结构化数据存储；非结构化数据（如用户上传的图片/视频）存储于MongoDB和阿里云OSS，本文档聚焦MySQL关系型数据库设计。
1.3 设计原则
	•	规范化优先：遵循第三范式（3NF），减少数据冗余；
	•	可扩展性：预留字段与分库分表接口，支持业务增长；
	•	性能优化：合理设计索引，平衡读写效率；
	•	安全性：敏感数据加密存储，严格权限控制；
	•	兼容性：适配MySQL 8.0+版本，支持跨平台部署。
二、概念结构设计
2.1 核心实体与属性
| 实体名称 | 核心属性 |
|---------|---------|
| 用户（User） | 用户ID、用户名、密码哈希、邮箱、手机号、权限角色、创建时间 |
| 地域（Region） | 地域ID、名称、父地域ID、经纬度、人口、语言、描述 |
| 专题（Topic） | 专题ID、标题、封面URL、内容、关联地域ID、作者ID、状态、创建时间 |
| 用户贡献（UserContribution） | 贡献ID、用户ID、关联地域ID、内容类型、文字内容、媒体URL、审核状态、创建时间 |
| 互动记录（Interaction） | 互动ID、用户ID、目标类型（专题/贡献）、目标ID、互动类型（点赞/收藏）、创建时间 |
2.2 实体关系（E-R图文字描述）
	•	用户与专题：1:N（一个用户可发布多个专题）；
	•	用户与贡献：1:N（一个用户可提交多个贡献）；
	•	地域与专题：1:N（一个地域可关联多个专题）；
	•	地域与贡献：1:N（一个地域可关联多个用户贡献）；
	•	用户与互动：1:N（一个用户可对多个内容点赞/收藏）；
	•	内容与互动：1:N（一个内容可被多个用户点赞/收藏）；
	•	地域与地域：1:N（父地域包含子地域，如国家→省份）。
三、逻辑结构设计
3.1 核心表结构（MySQL）
3.1.1 用户表（user）
| 字段名 | 数据类型 | 约束 | 备注 |
|-------|---------|------|------|
| user_id | INT(11) | PRIMARY KEY AUTO_INCREMENT | 用户唯一ID |
| username | VARCHAR(50) | NOT NULL UNIQUE | 用户名 |
| password_hash | VARCHAR(255) | NOT NULL | 密码哈希（MD5+盐） |
| email | VARCHAR(100) | UNIQUE | 邮箱（可选） |
| phone | VARCHAR(20) | UNIQUE | 手机号（可选） |
| role | ENUM('普通用户','认证用户','编辑','管理员') | NOT NULL | 权限角色 |
| create_time | DATETIME | NOT NULL | 创建时间 |
| update_time | DATETIME | NOT NULL | 更新时间 |
3.1.2 地域表（region）
| 字段名 | 数据类型 | 约束 | 备注 |
|-------|---------|------|------|
| region_id | INT(11) | PRIMARY KEY AUTO_INCREMENT | 地域唯一ID |
| region_name | VARCHAR(100) | NOT NULL | 地域名称（如“中国”） |
| parent_id | INT(11) | FOREIGN KEY REFERENCES region(region_id) | 父地域ID（顶级为0） |
| location | POINT | NOT NULL | 经纬度（空间类型） |
| population | BIGINT | | 人口数量 |
| language | VARCHAR(50) | | 主要语言 |
| description | TEXT | | 地域描述 |
3.1.3 专题表（topic）
| 字段名 | 数据类型 | 约束 | 备注 |
|-------|---------|------|------|
| topic_id | INT(11) | PRIMARY KEY AUTO_INCREMENT | 专题唯一ID |
| title | VARCHAR(200) | NOT NULL | 专题标题 |
| cover_url | VARCHAR(255) | | 封面图片URL（OSS地址） |
| content | TEXT | NOT NULL | 专题内容（Markdown格式） |
| region_id | INT(11) | FOREIGN KEY REFERENCES region(region_id) | 关联地域ID |
| author_id | INT(11) | FOREIGN KEY REFERENCES user(user_id) | 作者ID |
| status | ENUM('草稿','已发布','已下架') | NOT NULL | 专题状态 |
| create_time | DATETIME | NOT NULL | 创建时间 |
| update_time | DATETIME | NOT NULL | 更新时间 |
3.1.4 用户贡献表（user_contribution）
| 字段名 | 数据类型 | 约束 | 备注 |
|-------|---------|------|------|
| contribution_id | INT(11) | PRIMARY KEY AUTO_INCREMENT | 贡献唯一ID |
| user_id | INT(11) | FOREIGN KEY REFERENCES user(user_id) | 提交用户ID |
| region_id | INT(11) | FOREIGN KEY REFERENCES region(region_id) | 关联地域ID |
| content_type | ENUM('文字','图片','视频') | NOT NULL | 内容类型 |
| content | TEXT | | 文字内容（图片/视频时为空） |
| media_url | VARCHAR(255) | | 媒体URL（OSS地址） |
| status | ENUM('待审核','审核通过','审核拒绝') | NOT NULL | 审核状态 |
| create_time | DATETIME | NOT NULL | 创建时间 |
| audit_time | DATETIME | | 审核时间 |
| auditor_id | INT(11) | FOREIGN KEY REFERENCES user(user_id) | 审核员ID |
3.1.5 收藏表（collection）
| 字段名 | 数据类型 | 约束 | 备注 |
|-------|---------|------|------|
| collection_id | INT(11) | PRIMARY KEY AUTO_INCREMENT | 收藏唯一ID |
| user_id | INT(11) | FOREIGN KEY REFERENCES user(user_id) | 用户ID |
| target_type | ENUM('专题','贡献内容') | NOT NULL | 目标类型 |
| target_id | INT(11) | NOT NULL | 目标ID（专题/贡献ID） |
| create_time | DATETIME | NOT NULL | 收藏时间 |
3.1.6 点赞表（like）
与收藏表结构一致，替换collection_id为like_id即可。
四、物理结构设计
4.1 存储引擎选择
	•	MySQL表：全部使用InnoDB引擎（支持事务、外键、行级锁）；
	•	非结构化数据：用户贡献的文字内容存储于MongoDB，图片/视频存储于阿里云OSS；
	•	缓存数据：热门专题、地域信息存储于Redis（减少数据库查询）。
4.2 索引设计
| 表名 | 索引类型 | 索引字段 | 目的 |
|------|---------|---------|------|
| user | 唯一索引 | email、phone、username | 快速登录验证 |
| region | 空间索引 | location | 地图空间查询（如附近地域） |
| topic | 普通索引 | region_id、author_id、create_time | 按地域/作者/时间筛选专题 |
| user_contribution | 普通索引 | user_id、region_id、status | 按用户/地域/审核状态筛选贡献 |
| collection | 复合索引 | user_id、target_type+target_id | 快速查询用户收藏 |
4.3 分库分表策略
	•	初期：单库单表（满足50万用户以内需求）；
	•	中期：
	•	地域分库：按大洲分库（如亚洲库、欧洲库），隔离地域数据；
	•	时间分表：user_contribution按月份分表（如user_contribution_202501）；
	•	后期：使用ShardingSphere实现分布式分库分表。
五、数据安全与维护
5.1 数据安全
	•	加密存储：用户密码用MD5加盐哈希，敏感数据（手机号）用AES加密；
	•	权限控制：数据库用户分为只读（业务查询）、读写（业务操作）、管理员（维护）三级；
	•	SQL注入防护：开发时使用参数化查询（如MyBatis的`#{}），避免拼接SQL。
5.2 备份策略
| 备份类型 | 频率 | 存储位置 | 保留周期 |
|---------|------|---------|---------|
| 全量备份 | 每日凌晨3点 | 异地服务器（阿里云OSS） | 30天 |
| 增量备份 | 每小时 | 本地服务器+异地备份 | 7天 |
| binlog备份 | 实时 | 异地服务器 | 30天 |
5.3 维护策略
	•	性能优化：每周执行ANALYZE TABLE更新统计信息，每月执行OPTIMIZE TABLE清理碎片；
	•	数据清理：定期删除审核拒绝的贡献内容（保留30天）、过期备份文件；
	•	故障处理：设置MySQL主从复制，主库故障时自动切换到从库，通过备份+binlog恢复数据。
六、验收标准
	•	结构一致性：所有表结构与逻辑设计一致，无冗余字段；
	•	索引有效性：核心查询（如登录、专题筛选）响应时间≤100ms；
	•	安全性：敏感数据加密存储，权限控制严格；
	•	备份可靠性：随机抽取备份文件，能成功恢复数据。
本文档为平台数据库设计的核心依据，开发阶段需严格遵循，后续业务扩展时可基于此文档迭代优化。

